<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="./css/bootstrap.css" />
		<link rel="stylesheet" href="./css/bootstrap-icons.css" />
		<script src="./js/bootstrap.bundle.js"></script>
		<title></title>
		<style>
			/* form {
				margin: 50px auto;
				width: 300px;
				background-color: lightblue;
				text-align: center;
			} */
			.update {
				outline: none;
				border: 0px;
			}
		</style>
	</head>
	<body>
		<div id="come">

		</div>

		<!-- <form action="user/reg" method="post"> -->
		<!-- <h2>添加</h2> -->
		<!-- 用户名:<input type="text" id="uname" name="uname"><br> -->
		<!-- 	密码:<input type="password" id="pwd" name="pwd"><br>
			确认密码: <input type="password" id="repwd" name="repwd"> <br> -->
		<!-- 性别:<input type="text" id="sex" name="sex" value=""><br> -->
		<!-- 性别:男<input type="radio" id="" name="sex" value="1">
			     女<input type="radio" id="" name="sex" value="0"><br> -->
		<!-- 	年龄: <input type="text" id="age" name="age"><br>
			电话: <input type="text" id="phone" name="phone" maxlength="11"><span id="pmsg"></span><br>
			邮箱: <input type="text" id="email" name="email" maxlength="20"><span id="emsg"></span><br> -->
		<!-- <input type="submit" id="btn" value="添加" > -->
		<hr>
		<button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#add">添加</button><br><br>
		<input type="text" class="form-control" id="searchname" placeholder="" style="width:200px">&nbsp;<br>
		<button type="button" id="btn2" class="btn btn-secondary">查询</button><br><br>
		<!-- <input type="submit" id="btn2" value="查询"> -->
		<div>
			<table class="table table-striped" id="cont">



			</table>
		</div>
		<!-- <hr> -->
		<!-- boot弹出框****************************************** -->


		<!-- <button type="button" class="btn btn-primary" >修改</button> -->
		<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" >修改</button> -->
		<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@getbootstrap">删除</button> -->

		<!-- aria-labelledby="exampleModalLabel" aria-hidden="true"    data-bs-whatever="@fat" -->

		<div class="modal fade" id="add" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">添加联系人</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">用户名:</label>
								<input type="text" class="form-control" id="uname" placeholder="">
							</div>
							<div class="mb-3">
								<label for="message-text" class="col-form-label">性别</label>
								<input type="text" class="form-control" id="sex" placeholder="">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">年龄:</label>
								<input type="text" class="form-control" id="age" placeholder="">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">电话:</label><span id="pmsg"></span>
								<input type="text" class="form-control" id="phone" placeholder="" maxlength="11">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">邮箱:</label><span id="emsg"></span>
								<input type="text" class="form-control" id="email" placeholder="" maxlength="20">
							</div>
						</form>
					</div>
					<div class="modal-footer" id="cont2">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
						<button type="button" id="btn" class="btn btn-primary">确认提交</button>
					</div>
				</div>
			</div>
		</div>



		<div class="modal fade" id="exampleModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="exampleModalLabel">修改信息</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">用户名:</label>
								<input type="text" class="form-control" id="unameu" placeholder="">
							</div>
							<div class="mb-3">
								<label for="message-text" class="col-form-label">性别</label>
								<input type="text" class="form-control" id="sexu" placeholder="">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">年龄:</label>
								<input type="text" class="form-control" id="ageu" placeholder="">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">电话:</label>
								<input type="text" class="form-control" id="phoneu" placeholder="" maxlength="11">
							</div>
							<div class="mb-3">
								<label for="recipient-name" class="col-form-label">邮箱:</label>
								<input type="text" class="form-control" id="emailu" placeholder="" maxlength="20">
							</div>
						</form>
					</div>
					<div class="modal-footer" id="cont2">
						<!-- <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button> -->
						<!-- <button type="button" class="btn btn-primary">确认修改</button> -->
					</div>
				</div>
			</div>
		</div>

		<!--bootend *********************************************************************************************** -->

		<div>
			<!-- 	用户名:<input type="text" class="update" id="unameu" placeholder=""><br>
					性别:<input type="text" class="update" id="sexu" placeholder=""><br> -->

			<!-- 性别:男<input type="radio" id="" name="sex" value="1">
					     女<input type="radio" id="" name="sex" value="0"><br> -->

			<!-- 	年龄: <input type="text" class="update" id="ageu" placeholder="" ><br>
					电话: <input type="text" class="update" id="phoneu" placeholder="" maxlength="11"><br>
					邮箱: <input type="text" class="update" id="emailu"  placeholder="" maxlength="20"></span><br> -->
			<!-- <table id="cont2"> -->

			<!-- </table> -->
		</div>

		<!-- </form> -->






		<script src="js/ajax.js"></script>
		<script>
			//  首次数据    ******************************************************************************
			get(
				'GET',
				'/info/search', {
					uname: uname.value
					// pwd:pwd.value,
					// sex:sex.value,
					// age:age.value,
					// phone:phone.value,
					// email:email.value
				},
				function(res) {
					// console.log(res);
					if (res.length > 0) {
						// alert("succsee")
						for (i = 0, s = ''; i < res.length; i++) {
							s += `
							<tr>
								<td>${i+1}</td>
								<td>${res[i].uname}</td>
								<td>${res[i].sex==1?"男":"女"}</td>
								<td>${res[i].age}</td>
								<td>${res[i].email}</td>
								<td>${res[i].phone}</td>
								<td>
									<button type="button" onclick="ud(${res[i].iid})" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" >修改</button>
									<button type="button" onclick="del(${res[i].iid})" class="btn btn-danger"  >删除</button>
								</td>
							</tr>
							
						`
						}

						// <button onclick="ud(${res[i].iid})">修改</button>
						// <button onclick="del(${res[i].iid})">删除</button>

						// id="ud"+${res[i].iid} 
						var s1 = `<tr>
					<th>序号</th>
					<th>姓名</th>
					<th>性别</th>
					<th>年龄</th>
					<th>电话</th>
					<th>邮箱</th>
					<th>操作</th>
				</tr>`
						cont.innerHTML = s1 + s
						var s2 = `<h1>欢迎来到 ${res[0].uname} 电话本!!!</h1>`
						come.innerHTML = s2

						// window.location.href="login.html"
					} else {
						alert("错误")
					}
				}
			)

			//首次数据刷新结束 ******************************************************************

			var b1 = false
			var b2 = false
			phone.onblur = function() {
				if (/^1[3-9]\d{9}$/.test(phone.value)) {
					pmsg.innerHTML = "success"
					pmsg.style.color = "green"
					b1 = true
				} else {
					pmsg.innerHTML = "error"
					pmsg.style.color = "red"
					b1 = false
				}
			}
			email.onblur = function() {
				if (/^\w{3,9}@\w{2,3}.com$/.test(email.value)) {
					emsg.innerHTML = "success"
					emsg.style.color = "green"
					b2 = true
				} else {
					emsg.innerHTML = "error"
					emsg.style.color = "red"
					b2 = false
				}
			}

			
			btn.onclick = function() {
				if (b1 & b2) {
					post(
						'POST',
						'/info/add', {
							uname: uname.value,
							// pwd:pwd.value,
							sex: sex.value = "男" ? 1 : 0,
							age: age.value,
							phone: phone.value,
							email: email.value
						},
						function(res) {
							console.log(res);
							if (res.code == 200) {
								alert("succsee")
								// window.location.href="login.html"
							} else {
								alert("错误")
							}
						}
					)
				}else{
					alert("数据错误,提交不了")
				}
				// console.log(sex.value);
				

				get(
					'GET',
					'/info/search', {
						uname: ""
						// pwd:pwd.value,
						// sex:sex.value,
						// age:age.value,
						// phone:phone.value,
						// email:email.value
					},
					function(res) {
						// console.log(res);
						if (res.length > 0) {
							// alert("succsee")
							for (i = 0, s = ''; i < res.length; i++) {
								s += `
								<tr>
									<td>${i+1}</td>
									<td>${res[i].uname}</td>
									<td>${res[i].sex==1?"男":"女"}</td>
									<td>${res[i].age}</td>
									<td>${res[i].email}</td>
									<td>${res[i].phone}</td>
									<td>
										<button type="button" onclick="ud(${res[i].iid})" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" >修改</button>
										<button type="button" onclick="del(${res[i].iid})" class="btn btn-danger"  >删除</button>
									</td>
								</tr>
								
							`
							}

							// <button onclick="ud(${res[i].iid})">修改</button>
							// <button onclick="del(${res[i].iid})">删除</button>

							// id="ud"+${res[i].iid} 
							var s1 = `<tr>
						<th>序号</th>
						<th>姓名</th>
						<th>性别</th>
						<th>年龄</th>
						<th>电话</th>
						<th>邮箱</th>
						<th>操作</th>
					</tr>`
							cont.innerHTML = s1 + s
							var s2 = `<h1>欢迎来到 ${res[0].uname} 电话本!!!</h1>`
							come.innerHTML = s2

							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				)

			}

			btn2.onclick = function() {
				get(
					'GET',
					'/info/search', {
						uname: searchname.value
						// pwd:pwd.value,
						// sex:sex.value,
						// age:age.value,
						// phone:phone.value,
						// email:email.value
					},
					function(res) {
						console.log(res);
						if (res.length > 0) {
							alert("succsee")
							for (i = 0, s = ''; i < res.length; i++) {
								s += `
								<tr>
									<td>${i+1}</td>
									<td>${res[i].uname}</td>
									<td>${res[i].sex==1?"男":"女"}</td>
									<td>${res[i].age}</td>
									<td>${res[i].email}</td>
									<td>${res[i].phone}</td>
									<td>
										<button type="button" onclick="ud(${res[i].iid})" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" >修改</button>
										<button type="button" onclick="del(${res[i].iid})" class="btn btn-danger"  >删除</button>
									</td>
								</tr>
								
							`
							}

							// <button onclick="ud(${res[i].iid})">修改</button>
							// <button onclick="del(${res[i].iid})">删除</button>

							// id="ud"+${res[i].iid} 
							var s1 = `<tr>
						<th>序号</th>
						<th>姓名</th>
						<th>性别</th>
						<th>年龄</th>
						<th>电话</th>
						<th>邮箱</th>
						<th>操作</th>
					</tr>`
							cont.innerHTML = s1 + s
							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				)
			}

			function del(s) {
				get(
					'DELETE',
					'/info/delete', {
						iid: s
						// uname:uname.value,
						// // pwd:pwd.value,
						// sex:sex.value,
						// age:age.value,
						// phone:phone.value,
						// email:email.value
					},
					function(res) {
						// console.log(res);
						if (res.code == 200) {
							alert("succsee")
							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				);
				get(
					'GET',
					'/info/search', {
						uname: ""
						// pwd:pwd.value,
						// sex:sex.value,
						// age:age.value,
						// phone:phone.value,
						// email:email.value
					},
					function(res) {
						console.log(res);
						if (res.length > 0) {
							// alert("succsee")
							for (i = 0, s = ''; i < res.length; i++) {
								s += `
								<tr>
									<td>${i+1}</td>
									<td>${res[i].uname}</td>
									<td>${res[i].sex==1?"男":"女"}</td>
									<td>${res[i].age}</td>
									<td>${res[i].email}</td>
									<td>${res[i].phone}</td>
									<td>
										<button type="button" onclick="ud(${res[i].iid})" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exampleModal" >修改</button>
										<button type="button" onclick="del(${res[i].iid})" class="btn btn-danger"  >删除</button>
									</td>
								</tr>
								
							`
							}
							var s1 = `<tr>
							<th>序号</th>
							<th>姓名</th>
							<th>性别</th>
							<th>年龄</th>
							<th>电话</th>
							<th>邮箱</th>
							<th>操作</th>
						</tr>`
							cont.innerHTML = s1 + s
							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				)

			}

			function ud(s) {
				get(
					'GET',
					'/info/searchi', {
						iid: s
						// pwd:pwd.value,
						// sex:sex.value,
						// age:age.value,
						// phone:phone.value,
						// email:email.value
					},
					function(res) {
						// console.log(res);
						if (res.length > 0) {
							// alert("succsee")
							// for(i=0,s='';i<res.length;i++){
							// 	s+=`
							// 		<tr>
							// 			<td>${i+1}</td>
							// 			<td>${res[i].uname}</td>
							// 			<td>${res[i].sex==1?"男":"女"}</td>
							// 			<td>${res[i].age}</td>
							// 			<td>${res[i].email}</td>
							// 			<td>${res[i].phone}</td>
							// 		</tr>
							// 	`
							// }
							var s = `
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
						<button type="button" class="btn btn-primary" onclick="zud(${res[0].iid})">确认修改</button>`
							cont2.innerHTML = s
							// <button type="button" class="btn btn-primary">确认修改</button>
							unameu.placeholder = res[0].uname
							sexu.placeholder = res[0].sex
							ageu.placeholder = res[0].age
							phoneu.placeholder = res[0].phone
							emailu.placeholder = res[0].email

							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				)
			}

			function zud(s) {
				post(
					'PUT',
					'/info/update', {
						// pwd:pwd.value,
						uname: unameu.value,
						sex: sexu.value,
						age: ageu.value,
						phone: phoneu.value,
						email: emailu.value,
						prename: unameu.placeholder,
						iid: s

					},
					function(res) {
						// console.log(res);
						if (res.code == 200) {
							alert("succsee")
							// window.location.href="login.html"
						} else {
							alert("错误")
						}
					}
				)
			}
		</script>
	</body>
</html>